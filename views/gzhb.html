<script  src="../assets/js/header.js"></script>
    <title>工作汇报</title>
    <style>
		#video {
		  width: 100%;
		}

		.is-hidden {
		  display: none;
		}

		.iconfont {
		  font-size: 24px;
		}

		.btns {
		  margin-bottom: 10px;
		}

		#btnScreenshot {
		  font-size: 22px;
		  padding: 8px 10px;
		  border: 2px solid #ccc;
		  border-radius: 10px;
		}

		.video-screenshot {
		  display: grid;
		  grid-template-columns: 1fr 1fr;
		  grid-column-gap: 10px;
		}

	
    </style>
</head>
<body class="layui-view-body">
    <div class="layui-content">
        <div class="layui-row">
        
            <div class="layui-card">
		          <div class="layui-card-header">工作汇报</div>
		          <div class="layui-card-body">
						<div class="btns">
						  
						  <button class="button" id="btnScreenshot">
						    <i class="iconfont icon-camera">获取照片</i>
						  </button>
						  
						</div>
						<div class="video-screenshot">
						  <video autoplay id="video"></video>
						  <div>
						    <div id="screenshotsContainer">
						      <canvas id="canvas" class="is-hidden"></canvas>
						    </div>
						  </div>
						</div>


		          </div>
		    </div>
            
        </div>
    </div>
<script src="../assets/js/footer.js"></script>
<script>
layui.use(['element', 'laydate','table','upload'], function(){
 		var table = layui.table
    	,admin = layui.element
    	,laydate = layui.laydate
    	, $ = layui.jquery
    	,upload = layui.upload;
    	var photoLength = 6;

		window.onload = async function () {
		  if (
		    !"mediaDevices" in navigator ||
		    !"getUserMedia" in navigator.mediaDevices
		  ) {
		    document.write('当前浏览器不支持Camera API，请更新浏览器。')
		    return;
		  }

		  const video = document.querySelector("#video");
		  const canvas = document.querySelector("#canvas");
		  const screenshotsContainer = document.querySelector("#screenshotsContainer");
		  let videoStream = null
		  let useFrontCamera = false; // 前置摄像头
		  const constraints = {
		    video: {
		      width: {
		        min: 1280,
		        ideal: 1920,
		        max: 2560,
		      },
		      height: {
		        min: 720,
		        ideal: 1080,
		        max: 1440,
		      }
		    },
		  };
	
		  // 截图
		  btnScreenshot.addEventListener("click", function () {
		  		
		  		var parentDom=$('#screenshotsContainer').find("img");
		  		var i=parentDom.length;
		  	
		  if (photoLength>i) {
		  		
		  		console.log(i)
		  		let img = document.getElementById('screenshot');
			    if (!img) {
			      img = document.createElement("img");
			      img.id = 'screenshot'+i;
			      img.style.width = '100%';
			    }
			    canvas.width = video.videoWidth;
			    canvas.height = video.videoHeight;
			    canvas.getContext("2d").drawImage(video, 0, 0);
			    img.src = canvas.toDataURL("image/png");
			    screenshotsContainer.prepend(img);
			  }
		    return i;
		  });

		  async function init() {
		    // stopVideoStream();
		    constraints.video.facingMode = useFrontCamera ? "user" : "environment";
		    try {
		      videoStream = await navigator.mediaDevices.getUserMedia(constraints);
		      video.srcObject = videoStream;
		    } catch (error) {
		      console.log(error)
		    }
		  }
		  init();
		}  
});
</script>
